H5PEditor.ListEditor=function(e){return function(t){var o,n,r,i,d=this,a=t.getEntity(),s=e("<ul/>",{id:t.getId(),"aria-describedby":t.getDescriptionId(),class:"h5p-ul"}),l=ns.createButton(t.getImportance(),H5PEditor.t("core","addEntity",{":entity":a}),(function(){t.addItem()}),!0);d.defaultConfirmHandler=function(e,t,o,n){const r=new H5P.ConfirmationDialog({dialogText:H5PEditor.t("core","confirmRemoval",{":type":a})}).appendTo(document.body);r.on("confirmed",n),r.show(o.top)};let p=d.defaultConfirmHandler;d.setConfirmHandler=function(e){p=e},d.addItem=function(d){var a,l,c=e("<li/>",{class:"h5p-li"}),f=function(d){if(l){if(!(d.pageX>l.x+5||d.pageX<l.x-5||d.pageY>l.y+5||d.pageY<l.y-5))return;H5PEditor.Html.removeWysiwyg(),l=null;var p=c.offset();o=d.pageX-p.left,n=d.pageY-p.top,r=parseInt(c.css("marginTop")),i=s.offsetParent().offset();var f=c.width(),u=c.height();c.addClass("moving").css({width:f,height:u}),a=e("<li/>",{class:"placeholder h5p-li",css:{width:f,height:u}}).insertBefore(c)}!function(e,d,a,s){var l;a-=o,s-=n,e.css({top:s-r-i.top,left:a-i.left});var p=e.prev().prev();if(p.length&&s<p.offset().top+p.height()/2)return p.insertAfter(e),l=e.index(),void t.moveItem(l,l-1);var c=e.next();c.length&&s+e.height()>c.offset().top+c.height()/2&&(c.insertBefore(d),l=e.index()-2,t.moveItem(l,l+1))}(c,a,d.pageX,d.pageY)},u=function(){H5P.$window.unbind("mousemove",f).unbind("mouseup",u),H5P.$body.css({"-moz-user-select":"","-webkit-user-select":"","user-select":"","-ms-user-select":""}).attr("unselectable","off")[0].onselectstart=H5P.$body[0].ondragstart=null,l||(c.removeClass("moving").css({width:"auto",height:"auto"}),a.remove(),d instanceof H5PEditor.Group&&(d.preventToggle=!0))},m=e("<div/>",{class:"list-item-title-bar",appendTo:c}),v=e("<div/>",{class:"list-actions",appendTo:m}),g=e("<div/>",{class:"order-group",appendTo:v});if(H5PEditor.createButton("order-up",H5PEditor.t("core","orderItemUp"),(function(){var e=c.prev();if(e.length){H5PEditor.Html.removeWysiwyg();var o=c.index();e.insertAfter(c),t.moveItem(o,o-1)}})).appendTo(g),H5PEditor.createButton("order-down",H5PEditor.t("core","orderItemDown"),(function(){var e=c.next();if(e.length){H5PEditor.Html.removeWysiwyg();var o=c.index();e.insertBefore(c),t.moveItem(o,o+1)}})).appendTo(g),H5PEditor.createButton("remove",H5PEditor.t("core","removeItem"),(function(){p(d,c.index(),e(this).offset(),(function(){t.removeItem(c.index()),c.remove()}))})).appendTo(v),d instanceof H5PEditor.Group)d.appendTo(c),c.addClass("listgroup"),m.addClass(t.getImportance()),c.children(".field").children(".title").appendTo(m).addClass("h5peditor-label"),d.on("expanded",(function(){c.addClass("expanded").removeClass("collapsed")})),d.on("collapsed",(function(){c.removeClass("expanded").addClass("collapsed")}));else{var h=e("<div/>",{class:"content"}).appendTo(c);if(m.addClass(t.getImportance()),d.appendTo(h),0!==d.field.label){const t=h.children(".field").find(".h5peditor-label:first");0!==t.length&&(m.append(e("<label/>",{class:"h5peditor-label",for:t.parent().attr("for"),html:t.html()})),t.hide())}}c.appendTo(s),d instanceof H5PEditor.Group&&!1!==d.field.expanded&&d.expand(),m.children(".h5peditor-label").mousedown((function(e){1===e.which&&(l={x:e.pageX,y:e.pageY},H5P.$window.mousemove(f).mouseup(u),H5P.$body.css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).attr("unselectable","on")[0].onselectstart=H5P.$body[0].ondragstart=function(){return!1})}))},d.isTextField=function(e){var t=ns.getWidgetName(e.field);return"html"===t||"text"===t},d.appendTo=function(e){s.appendTo(e),l.appendTo(e)},d.remove=function(){s.remove(),l.remove()}}}(H5P.jQuery);