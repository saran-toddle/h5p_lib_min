window.ns=window.H5PEditor=window.H5PEditor||{},ns.Editor=function(e,t,n,o){var r=this;e=e&&0!=e?e:"";let i={};try{i=JSON.parse(t)}catch(e){}var s=ns.$("<iframe/>",{css:{display:"block",width:"100%",height:"3em",border:"none",zIndex:101,top:0,left:0},class:"h5p-editor-iframe",frameBorder:"0",allowfullscreen:"allowfullscreen",allow:"fullscreen"});const l=i.metadata;let a="";l&&(l.a11yTitle?a=l.a11yTitle:l.title&&(a=l.title)),s.attr("title",a);var c=s.get(0),d=function(){if(!c.contentDocument)return;const e=l&&l.defaultLanguage?l.defaultLanguage:ns.contentLanguage;c.contentDocument.open(),c.contentDocument.write('<!doctype html><html lang="'+e+'"><head>'+ns.wrap('<link rel="stylesheet" href="',ns.assets.css,'">')+ns.wrap('<script src="',ns.assets.js,'"><\/script>')+'</head><body><div class="h5p-editor h5peditor">'+ns.t("core","loading")+"</div></body></html>"),c.contentDocument.close(),c.contentDocument.documentElement.style.overflow="hidden"};const u={scroll:0,client:0};r.resize=function(e){if(e=void 0!==e&&e,!c.contentDocument||!c.contentDocument.body||r.preventResize)return;const t=u.scroll===c.contentDocument.body.scrollHeight&&u.client===c.contentWindow.document.body.clientHeight;if(e||!(t||c.clientHeight===c.contentDocument.body.scrollHeight&&Math.abs(c.contentDocument.body.scrollHeight-c.contentWindow.document.body.clientHeight)<=1)){u.scroll=c.contentDocument.body.scrollHeight,u.client=c.contentWindow.document.body.clientHeight;var n=c.parentElement.style.height;c.parentElement.style.height=c.parentElement.clientHeight+"px",c.style.height=c.contentWindow.document.body.clientHeight+"px",c.style.height=c.contentDocument.body.scrollHeight+"px",c.parentElement.style.height=n}};s.replaceAll(n),s.on("load",(function(){if(c.contentWindow.H5P){o&&o.call(this.contentWindow),r.iframeWindow=this.contentWindow;var n,i,l=this.contentWindow.H5PEditor.LibrarySelector,a=this.contentWindow.H5P.jQuery,u=a("body > .h5p-editor");if(this.contentWindow.H5P.$body=a(this.contentDocument.body),this.contentWindow.H5PEditor.semiFullscreen=function(e,t,n){const o=r.semiFullscreen(s,e,n);return t(),o},a.ajax({url:this.contentWindow.H5PEditor.getAjaxUrl(H5PIntegration.hubIsEnabled?"content-type-cache":"libraries")}).fail((function(){u.html("Error, unable to load libraries.")})).done((function(n){if(!1!==n.success){r.selector=new l(n,e,t),r.selector.appendTo(u.html("")),r.selector.on("resize",r.resize.bind(r));var o=function(e){H5P.externalDispatcher.trigger(e)};r.selector.on("editorload",o),r.selector.on("editorloaded",o),e&&r.selector.setLibrary(e)}else u.html(n.message+" ("+n.errorCode+")")})),void 0!==c.contentWindow.MutationObserver){var y,h=function(){y||(y=setTimeout((function(){r.resize(),y=null}),40))};new c.contentWindow.MutationObserver(h).observe(c.contentWindow.document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1}),H5P.$window.resize(h),r.resize()}else!function e(){r.resize(),setTimeout(e,40)}();n=a(c.contentWindow),i=function(){r.formSubmitted||(e=r.getLibrary(),t=JSON.stringify(r.getParams(!0)))},n.one("beforeunload unload",(function(){n.off("pagehide beforeunload unload"),i()})),n.on("pagehide",i)}else setTimeout((function(){d()}),0)})),d()},ns.Editor.prototype.getLibrary=function(){return void 0!==this.selector?this.selector.getCurrentLibrary():this.selectedContentTypeId?this.selectedContentTypeId:void console.warn('no selector defined for "getLibrary"')},ns.Editor.prototype.getParams=function(e){if(e||(this.formSubmitted=!0),void 0!==this.selector)return{params:this.selector.getParams(),metadata:this.selector.getMetadata()};console.warn('no selector defined for "getParams"')},ns.Editor.prototype.getContent=function(e,t){const n=this.iframeWindow.H5PEditor;if(!this.selector.form)return void(t&&t("content-not-selected"));const o={title:this.isMainTitleSet(),library:this.getLibrary(),params:this.getParams()};if(!o.title)return void(t&&t("missing-title"));if(!o.library)return void(t&&t("missing-library"));if(!o.params)return void(t&&t("missing-params"));if(!o.params.params)return void(t&&t("missing-params-params"));library=new n.ContentType(o.library);const r=n.ContentType.getPossibleUpgrade(library,void 0!==this.selector.libraries.libraries?this.selector.libraries.libraries:this.selector.libraries);r?n.upgradeContent(library,r,o.params,(function(i,s){i?t&&t(i):(o.library=n.ContentType.getNameVersionString(r),o.params=s,e(o))})):(o.params=JSON.stringify(o.params),e(o))},ns.Editor.prototype.isMainTitleSet=function(){var e=this.selector.form.metadataForm.getExtraTitleField(),t=e.validate();return t||e.$input.focus(),t},ns.Editor.prototype.getMaxScore=function(e){try{return this.selector.presave(e,this.getLibrary()).maxScore}catch(e){return 0}},ns.Editor.prototype.semiFullscreen=function(e,t,n){const o=this,r=e.add(t).addClass("h5peditor-semi-fullscreen");o.preventResize=!0;const i=document.body.style.getPropertyValue("overflow"),s=document.body.style.getPropertyPriority("overflow");document.body.style.setProperty("overflow","hidden","important"),e.css({width:"",height:"",zIndex:"",top:"",left:""});const l=e[0].contentWindow,a=ns.hideAllButOne(e[0],l),c=ns.hideAllButOne(t[0],window),d=function(e){27===e.which&&u()};l.document.body.addEventListener("keyup",d);const u=function(){r.removeClass("h5peditor-semi-fullscreen"),o.preventResize=!1,document.body.style.setProperty("overflow",i,s),e.css({width:"100%",height:"3em",zIndex:101,top:0,left:0}),a(),c(),l.document.body.removeEventListener("keyup",d),n(),o.resize(!0)};return u},ns.hideAllButOne=function(e,t){const n=[],o=function(e){return null!==e.offsetParent||"none"!==t.getComputedStyle(e).display},r=function(e){for(let t=0;t<e.parentElement.children.length;t++){let r=e.parentElement.children[t];r!==e&&(o(r)&&(n.push({element:r,display:r.style.getPropertyValue("display"),priority:r.style.getPropertyPriority("display")}),r.style.setProperty("display","none","important")))}"BODY"!==e.parentElement.tagName&&r(e.parentElement)};return r(e),function(){for(let e=n.length-1;e>-1;e--)n[e].element.style.setProperty("display",n[e].display,n[e].priority)}},ns.language={},ns.t=function(e,t,n){if(void 0===ns.language[e])return"Missing translations for library "+e;var o;if("core"===e){if(void 0===ns.language[e][t])return"Missing translation for "+t;o=ns.language[e][t]}else{if(void 0===ns.language[e].libraryStrings||void 0===ns.language[e].libraryStrings[t])return ns.t("core","missingTranslation",{":key":t});o=ns.language[e].libraryStrings[t]}for(var r in n)void 0!==n[r]&&(o=o.replace(r,n[r]));return o},ns.wrap=function(e,t,n){for(var o="",r=0;r<t.length;r++)o+=e+t[r]+n;return o};