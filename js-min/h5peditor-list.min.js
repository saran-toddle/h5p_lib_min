H5PEditor.List=function(t){function e(e,i,r,o){var n=this;H5PEditor.SemanticStructure.call(n,i,{name:"ListEditor",label:H5PEditor.t("core","listLabel")}),n.parent=e;var d=[],a=[],c=!0;e.ready((function(){c=!1})),n.on("changeWidget",(function(){for(var t=0;t<d.length;t++)n.widget.addItem(d[t],t)}));var v=function(t,e){void 0===r&&o(i,r=[]),r[t]=e},l=function(t,e){var o=i.field,a=H5PEditor.getWidgetName(o);void 0!==r&&void 0!==r[t]||void 0===o.default||v(t,o.default),void 0!==e&&v(t,e);var c=d[t]=new H5PEditor.widgets[a](n,o,void 0===r?void 0:r[t],(function(e,i){var r=u(c);v(void 0===r?t:r,i)}));return c},u=function(t){for(var e=0;e<d.length;e++)if(d[e]===t)return e};n.getEntity=function(){return void 0===i.entity?"item":i.entity},n.addItem=function(t){var e=d.length;if(i.max===e)return!1;var r=l(e,t);if(n.widget.addItem(r,e),!c){for(var o=0;o<a.length;o++)a[o]();a=[]}return n.trigger("addedItem",r),!0},n.removeItem=function(t){d[t].remove(),d.splice(t,1),void 0!==r&&(r.splice(t,1),r.length||(r=void 0,o(i))),n.trigger("removedItem",t)},n.removeAllItems=function(){if(void 0!==r){for(var t=0;t<d.length;t++)d[t].remove();d=[],r=void 0,o(i)}},n.moveItem=function(t,e){var i=d.splice(t,1);if(d.splice(e,0,i[0]),r){var o=r.splice(t,1);r.splice(e,0,o[0])}},n.forEachChild=function(t){for(var e=0;e<d.length;e++)t(d[e],e)},n.ready=function(t){c?e.ready(t):a.push(t)},n.validate=function(){var t=this,e=!0;t.clearErrors();for(var r=0;r<d.length;r++)!1===d[r].validate()&&(e=!1);return void 0!==i.max&&i.max>0&&void 0!==d&&d.length>i.max&&(e=!1,t.setError(H5PEditor.t("core","listExceedsMax",{":max":i.max}))),void 0!==i.min&&i.min>0&&(void 0===d||d.length<i.min)&&(e=!1,t.setError(H5PEditor.t("core","listBelowMin",{":min":i.min}))),e},n.getImportance=function(){return void 0!==i.importance?H5PEditor.createImportance(i.importance):void 0!==i.field.importance?H5PEditor.createImportance(i.field.importance):""},n.getValue=function(){return void 0===r?r:t.extend(!0,[],r)},n.getField=function(){return t.extend(!0,{},i.field)},function(){var t;if(void 0!==r&&r.length)for(t=0;t<r.length;t++)null===r[t]&&(r[t]=void 0),l(t);else for(void 0===i.defaultNum&&(i.defaultNum=void 0!==i.min?i.min:1),t=0;t<i.defaultNum;t++)l(t)}()}return e.prototype=Object.create(H5PEditor.SemanticStructure.prototype),e.prototype.constructor=e,e}(H5P.jQuery),H5PEditor.widgets.list=H5PEditor.List;