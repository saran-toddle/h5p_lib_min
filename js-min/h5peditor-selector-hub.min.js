ns.SelectorHub=function(e,t,r){var n=this;H5P.EventDispatcher.call(this),this.getContentType=function(t){for(var r=0;r<e.libraries.length;r++){var n=e.libraries[r];if(n.machineName===t)return n}};var a={contentId:H5PEditor.contentId||0,contentTypes:e,getAjaxUrl:H5PEditor.getAjaxUrl,expanded:!0,canPaste:!1,enableContentHub:H5PEditor.enableContentHub||!1};if(t){var i=this.getContentType(t.split(" ")[0]);a.title=i?i.title||i.machineName:t.split(" ")[0],a.expanded=!1}this.client=new H5P.HubClient(a,H5PEditor.language.core),this.currentLibrary=t,this.client.on("select",(function(e){var t=e;if(t.machineName!==n.currentLibrary.split(" ")[0]){if(!n.currentLibrary)return n.currentLibrary=n.createContentTypeId(t,!0),void n.trigger("selected");n.currentLibrary=n.createContentTypeId(t,!0),delete n.currentParams,delete n.currentMetadata,r.show(ns.$(n.getElement()).offset().top)}}),this),this.client.on("upload",(function(t){e=t.contentTypes;var a=n.currentLibrary;const i=t.h5p.preloadedDependencies.filter((function(e){return e.machineName===t.h5p.mainLibrary}))[0];n.currentLibrary=n.createContentTypeId(i),n.currentParams=t.content,n.currentMetadata={title:t.h5p.title,authors:t.h5p.authors,license:t.h5p.license,licenseVersion:t.h5p.licenseVersion,licenseExtras:t.h5p.licenseExtras,yearFrom:t.h5p.yearFrom,yearTo:t.h5p.yearTo,source:t.h5p.source,changes:t.h5p.changes,authorComments:t.h5p.authorComments,defaultLanguage:t.h5p.defaultLanguage};const o=function(e){const t=ns.ContentType.getNameVersionString(e);var i=new FormData;i.append("libraryParameters",JSON.stringify({library:t,params:n.currentParams,metadata:n.currentMetadata}));var o=new XMLHttpRequest;o.onload=function(){try{result=JSON.parse(o.responseText),n.currentLibrary=result.data.library,n.currentParams=result.data.params,n.currentMetadata=result.data.metadata,a?r.show(ns.$(n.getElement()).offset().top):n.trigger("selected")}catch(e){H5P.error(e)}},o.open("POST",H5PEditor.getAjaxUrl("filter"),!0),o.send(i)},s=ns.ContentType.getPossibleUpgrade(i,e.libraries);s?ns.upgradeContent(i,s,{params:n.currentParams,metadata:n.currentMetadata},(function(e,t){if(e){var r=n.getContentType(n.currentLibrary.split(" ")[0]);n.client.setPanelTitle(r.title||r.machineName,!0)}else{const e=JSON.parse(t);n.currentParams=e.params,n.currentMetadata=e.metadata,n.currentLibrary=n.createContentTypeId(s,!0),o(s)}})):o(i)}),this),this.client.on("update",(function(t){e=t})),this.client.on("resize",(function(){n.trigger("resize")})),this.client.on("paste",(function(){n.trigger("paste")}))},ns.SelectorHub.prototype=Object.create(H5P.EventDispatcher.prototype),ns.SelectorHub.prototype.constructor=ns.SelectorHub,ns.SelectorHub.prototype.resetSelection=function(e,t,r,n){this.currentLibrary=e,this.currentParams=t,this.currentMetadata=r;var a=this.getContentType(e.split(" ")[0]);this.client.setPanelTitle(a.title||a.machineName,n)},ns.SelectorHub.prototype.setCanPaste=function(e,t){this.client.setCanPaste(e,t)},ns.SelectorHub.prototype.getSelectedLibrary=function(e){var t={uberName:this.currentLibrary},r=this.getContentType(this.currentLibrary.split(" ")[0]);return r&&(t.tutorialUrl=r.tutorial,t.exampleUrl=r.example),e(t)},ns.SelectorHub.prototype.getParams=function(){return this.currentParams},ns.SelectorHub.prototype.getMetadata=function(){return this.currentMetadata},ns.SelectorHub.prototype.getElement=function(){return this.client.getElement()},ns.SelectorHub.prototype.createContentTypeId=function(e,t){var r=e.machineName;return r+=t?" "+e.localMajorVersion+"."+e.localMinorVersion:" "+e.majorVersion+"."+e.minorVersion};