var H5PEditor=window.H5PEditor=window.H5PEditor||{},ns=H5PEditor;ns.widgets.image=function(i,t,e,s){var a=this;ns.File.call(a,i,t,e,s),this.parent=i,this.field=t,this.params=e,this.setValue=s,this.library=i.library+"/"+t.name,this.id=ns.getNextFieldId(t),void 0!==e&&(this.copyright=e.copyright),this.isEditing=!1,this.isOriginalImage=!1,this.changes=[],this.passReadies=!0,i.ready((function(){a.passReadies=!1})),this.confirmationDialog=new H5P.ConfirmationDialog({headerText:H5PEditor.t("core","removeImage"),bodyText:H5PEditor.t("core","confirmImageRemoval")}),this.confirmationDialog.on("confirmed",(function(){a.removeImage()})),a.on("upload",(function(){})),a.on("fileUploaded",(function(i){a.isOriginalImage&&delete a.params.originalImage,a.params.width=i.data.width,a.params.height=i.data.height,a.isEditing=!1}))},ns.widgets.image.prototype=Object.create(ns.File.prototype),ns.widgets.image.prototype.constructor=ns.widgets.image,ns.widgets.image.prototype.appendTo=function(i){var t=this,e='<div class="file"></div><div class="h5p-editor-image-buttons">';this.field.disableCopyright||(e+='<button class="h5peditor-button-textual h5p-copyright-button">'+ns.t("core","editCopyright")+"</button>"),e+='</div><div class="h5p-editor-dialog"><a href="#" class="h5p-close" title="'+ns.t("core","close")+'"></a></div>';var s=ns.createFieldMarkup(this.field,e,this.id),a=ns.$(s).appendTo(i);this.$item=a,this.$copyrightButton=a.find(".h5p-copyright-button"),this.$file=a.find(".file"),this.$errors=a.find(".h5p-errors"),this.addFile();var o=a.find(".h5p-editor-dialog");a.find(".h5p-copyright-button").add(o.find(".h5p-close")).click((function(){return o.toggleClass("h5p-open"),!1})),ns.File.addCopyright(t,o,(function(i,e){void 0!==t.params&&(t.params.copyright=e),t.copyright=e}))},ns.widgets.image.prototype.setCopyright=function(i){this.copyright=this.params.copyright=i},ns.widgets.image.prototype.addFile=function(){var i=this;if(void 0===this.params){let t='<a href="#" id="'+this.id+'" class="add"';return void 0!==this.field.description&&(t+=' aria-describedby="'+ns.getDescriptionId(this.id)+'"'),t+=' title="'+ns.t("core","addFile")+'"><div class="h5peditor-field-file-upload-text">'+ns.t("core","add")+"</div></a>",this.$file.html(t).children(".add").click((function(){return i.isOriginalImage=!0,i.openFileSelector(),!1})),this.$copyrightButton.addClass("hidden"),this.isEditing=!1,!1}var t=H5P.getPath(this.params.path,H5PEditor.contentId),e=void 0===this.field.label?"":this.field.label,s='<a href="#" id="'+this.id+'" title="'+ns.t("core","changeFile")+'" class="thumbnail"';void 0!==this.field.description&&(s+=' aria-describedby="'+ns.getDescriptionId(this.id)+'"'),s+='><img alt="'+e+'"/></a><a href="#" class="remove" title="'+ns.t("core","removeFile")+'"></a>',this.$file.html(s).children(":eq(0)").click((function(){return i.isOriginalImage=!0,i.openFileSelector(),!1})).children("img").attr("src",t).end().next().click((function(){return i.confirmRemovalDialog.show(i.$file.offset().top),!1}));var a=this.$file.find("img");return a.one("load",(function(){a.addClass("loaded")})),i.$copyrightButton.removeClass("hidden"),i.trigger("changedImage",this.params),!0},ns.widgets.image.prototype.removeImage=function(){this.trigger("removedImage",this.params),delete this.params,this.setValue(this.field),this.addFile();for(var i=0;i<this.changes.length;i++)this.changes[i]()},ns.widgets.image.prototype.validate=function(){return!0},ns.widgets.image.prototype.remove=function(){this.$file.parent().remove()},ns.widgets.image.prototype.ready=function(i){this.passReadies?this.parent.ready(i):i()};