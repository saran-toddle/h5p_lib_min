H5PEditor.MetadataForm=function(e,t,i){function n(i,n,l,c,p){var h=this;e.call(h),h.passReadies=!0;const u=H5PIntegration.user&&H5PIntegration.user.name?H5PIntegration.user.name:void 0;u&&(o("changes").field.fields[1].default=u,o("authors").field.fields[0].default=u);const f=function(e){var i=e.clientY-150;t("html,body").css("height","100%"),t(".h5peditor").append(m),g.css("margin-top",(i>20?i:20)+"px"),P.$input.focus()},v=function(){const e=H5PEditor.findField("a11yTitle",h).$item[0];h.isA11yExpanded=!h.isA11yExpanded,h.isA11yExpanded&&e.classList.remove("hidden"),e.classList[h.isA11yExpanded?"remove":"add"]("hide"),h.a11yTitleText.innerHTML=h.isA11yExpanded?d("a11yTitleHideLabel"):d("a11yTitleShowLabel"),e.setAttribute("aria-hidden",!h.isA11yExpanded)},m=t("<div>",{class:"overlay h5p-metadata-popup-overlay"}),g=t('<div class="h5p-metadata-wrapper"><div class="h5p-metadata-header"><div class="h5p-title-container"><h2>'+d("metadataSharingAndLicensingInfo")+"</h2><p>"+d("fillInTheFieldsBelow")+'</p></div><div class="metadata-button-wrapper"><button href="#" class="h5p-metadata-button h5p-save">'+d("saveMetadata")+"</button></div></div></div>");g.find(".h5p-save").click((function(){"U"!==n.license&&0===n.authors.length&&w.addDefaultAuthor(u,"Author"),t("html,body").css("height",""),m.detach()}));const y=t("<div/>",{class:"h5p-metadata-fields-wrapper",appendTo:g});g.appendTo(m);const E=t('<div role="button" tabindex="0" class="h5p-metadata-button-wrapper"><div class="h5p-metadata-button-tip"></div><div class="h5p-metadata-toggler">'+d("metadata")+"</div></div>").click(f).keydown((function(e){13!=e.which&&32!=e.which||f(e)}));h.ready=function(e){i.passReadies?i.ready(e):H.push(e)},h.appendTo=function(e){g.appendTo(e)},h.appendButtonTo=function(e){E.appendTo(e.children(".h5peditor-label-wrapper").wrap('<div class="h5p-editor-flex-wrapper"/>').parent())},h.getExtraTitleField=function(){return c?F:void 0};const T=[];c&&T.push(a()),T.push(o("title")),T.push(o("a11yTitle")),T.push(o("license")),T.push(o("licenseVersion")),T.push(o("yearFrom")),T.push(o("yearTo")),T.push(o("source"));const H=[];H5PEditor.processSemanticsChunk(T,n,y,h);let b=h.children;const P=H5PEditor.findField("title",h);var x,L;P.$input.click((function(){0===this.selectionStart&&this.selectionEnd===this.value.length||(this.select(),this.setSelectionRange(0,this.value.length))})),!n.title&&p&&P.$input.val(H5PEditor.LibraryListCache.getDefaultTitle(i.currentLibrary)).change(),P.$input.change((function(){h.trigger("titlechange")})),x=H5PEditor.findField("license",h),(L=H5PEditor.findField("licenseVersion",h)).field.optional=!0,x.changes.push((function(e){var t=function e(t){var i=[];return t.forEach((function(t){"optgroup"===t.type?i=i.concat(e(t.options)):i.push(t)})),i}(x.field.options),i=s(t,"value",e),a=i?i.versions:void 0;L.$select.prop("disabled",void 0===a),void 0===a&&(a=[{value:"-",label:"-"}]);var d=n.license===e&&n?n.licenseVersion:a[0].value;L.$select.html(H5PEditor.Select.createOptionsHtml(a,d)).change()})),x.changes[x.changes.length-1](n.license),H5PEditor.findField("source",h).$item.on("change",(function(){const e=t(this).find("input.h5peditor-text");""!==e.val().trim()&&0!==e.val().indexOf("https://")&&0!==e.val().indexOf("http://")&&e.val("http://"+e.val()).trigger("change")})),function(){const e=H5PEditor.findField("title",h),t=H5PEditor.findField("a11yTitle",h),i=e.$item[0].querySelector("label.h5peditor-label-wrapper"),n=document.createElement("button"),a=document.createElement("span");a.classList.add("h5p-a11y-title-text"),a.innerHTML=d("a11yTitleShowLabel"),h.a11yTitleText=a,n.classList.add("a11y-title-toggle"),n.appendChild(a),t.$item[0].classList.add("hide"),t.$item[0].setAttribute("aria-hidden",!0),t.$item[0].addEventListener("transitionend",(function(){h.isA11yExpanded||t.$item[0].classList.add("hidden")})),n.addEventListener("click",v),h.togglea11yTitleButton=n,h.isA11yExpanded=!1,i.appendChild(n)}();const w=H5PEditor.metadataAuthorWidget(o("authors").field.fields,n,y,h);b=b.concat(h.children),H5PEditor.processSemanticsChunk([o("licenseExtras")],n,y,h),b=b.concat(h.children),H5PEditor.metadataChangelogWidget([o("changes").field],n,y,h),b=b.concat(h.children);var A=new H5PEditor.widgets.group(h,{name:"additionals",label:"Additional information",fields:[o("authorComments")]},n.authorComments,(function(e,t){n.authorComments=t}));let F;if(A.appendTo(y),h.children=b.concat([A]),c&&(F=H5PEditor.findField("extraTitle",h),F.$item.appendTo(l),h.appendButtonTo(F.$item),r(P,F)),!i.passReadies)for(let e=0;e<H.length;e++)H[e]()}n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.createLegacyForm=function(e,t){const i={passReadies:!1,getExtraTitleField:function(){return H5PEditor.findField("title",i)}},n=a();return n.name="title",H5PEditor.processSemanticsChunk([n],e,t,i),i};const a=function(){const e=JSON.parse(JSON.stringify(o("title")));return e.name="extraTitle",e.description=d("usedForSearchingReportsAndCopyrightInformation"),delete e.placeholder,e},d=function(e){return H5PEditor.t("core",e)},o=function(e){for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t]},s=function(e,t,i){for(var n=t.split("."),a=0;a<e.length;a++){for(var d=e[a],o=0;o<n.length;o++)d=d[n[o]];if(d===i)return e[a]}},r=function(e){const t=arguments;let i;const n=function(e){if(!i&&void 0!==e){i=!0;for(let i=0;i<t.length;i++)t[i].$input.val(e).change();i=!1}};for(let e=0;e<t.length;e++)t[e].change(n);if(void 0!==t[0].value){const e=document.createElement("div");e.innerHTML=t[0].value,n(e.innerText)}};return n}(H5P.EventDispatcher,H5P.jQuery,H5PEditor.metadataSemantics);