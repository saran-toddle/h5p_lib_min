ns.File=function(i,e,t,r){var o=this;ns.FileUploader.call(o,e),this.parent=i,this.field=e,this.params=t,this.setValue=r,this.library=i.library+"/"+e.name,this.id=ns.getNextFieldId(e),void 0!==t&&(this.copyright=t.copyright),this.changes=[],this.passReadies=!0,i.ready((function(){o.passReadies=!1})),this.confirmRemovalDialog=new H5P.ConfirmationDialog({headerText:H5PEditor.t("core","removeFile"),dialogText:H5PEditor.t("core","confirmRemoval",{":type":"file"})}).appendTo(document.body),this.confirmRemovalDialog.on("confirmed",(function(){delete o.params,o.setValue(o.field),o.addFile();for(var i=0;i<o.changes.length;i++)o.changes[i]()})),o.on("upload",(function(){o.$file.html('<div class="h5peditor-uploading h5p-throbber">'+ns.t("core","uploading")+"</div>"),o.$errors.html("")})),o.on("uploadProgress",(function(i){o.$file.children().html(ns.t("core","uploading")+" "+Math.round(100*i.data)+" %")})),o.on("uploadComplete",(function(i){var e=i.data;try{if(e.error)throw e.error;o.params=o.params||{},o.params.path=e.data.path,o.params.mime=e.data.mime,o.params.copyright=o.copyright,o.trigger("fileUploaded",e.data),o.setValue(o.field,o.params);for(var t=0;t<o.changes.length;t++)o.changes[t](o.params)}catch(i){o.$errors.append(ns.createError(i))}o.addFile()}))},ns.File.prototype=Object.create(ns.FileUploader.prototype),ns.File.prototype.constructor=ns.File,ns.File.prototype.appendTo=function(i){var e=this,t='<div class="file"></div><a class="h5p-copyright-button" href="#">'+ns.t("core","editCopyright")+'</a><div class="h5p-editor-dialog"><a href="#" class="h5p-close" title="'+ns.t("core","close")+'"></a></div>',r=ns.createFieldMarkup(this.field,t,this.id),o=ns.$(r).appendTo(i);this.$copyrightButton=o.find(".h5p-copyright-button"),this.$file=o.find(".file"),this.$errors=o.find(".h5p-errors"),this.addFile();var a=o.find(".h5p-editor-dialog");o.find(".h5p-copyright-button").add(a.find(".h5p-close")).click((function(){return a.toggleClass("h5p-open"),!1})),ns.File.addCopyright(e,a,(function(i,t){void 0!==e.params&&(e.params.copyright=t),e.copyright=t}))},ns.File.addCopyright=function(i,e,t){var r=function(i,e,t){for(var r=e.split("."),o=0;o<i.length;o++){for(var a=i[o],s=0;s<r.length;s++)a=a[r[s]];if(a===t)return i[o]}};i.copyright&&("ODC PDDL"===i.copyright.license?(i.copyright.license="PD",i.copyright.version="CC0 1.0"):"CC PDM"===i.copyright.license&&(i.copyright.license="PD",i.copyright.version="CC PDM"));var o=new H5PEditor.widgets.group(i,H5PEditor.copyrightSemantics,i.copyright,t);o.appendTo(e),o.expand(),o.$group.find(".title").remove(),i.children=[o];var a=r(o.children,"field.name","license"),s=r(o.children,"field.name","version");s.field.optional=!0,a.changes.push((function(e){var t=r(a.field.options,"value",e).versions;s.$select.prop("disabled",void 0===t),void 0===t&&(t=[{value:"-",label:"-"}]);var o=i.copyright.license===e&&i.copyright.version?i.copyright.version:t[0].value;s.$select.html(H5PEditor.Select.createOptionsHtml(t,o)).change()})),a.changes[a.changes.length-1](i.copyright.license)},ns.File.prototype.addFile=function(){var i,e=this;if(void 0===this.params){let i='<a href="#" id="'+this.id+'" class="add"';return void 0!==this.field.description&&(i+=' aria-describedby="'+ns.getDescriptionId(this.id)+'"'),i+=' title="'+ns.t("core","addFile")+'"><div class="h5peditor-field-file-upload-text">'+ns.t("core","add")+"</div></a>",this.$file.html(i).children(".add").click((function(){return e.openFileSelector(),!1})),void this.$copyrightButton.addClass("hidden")}"image"===this.field.type?((i={}).path=H5P.getPath(this.params.path,H5PEditor.contentId),i.height=100,void 0!==this.params.width&&(i.width=i.height*(this.params.width/this.params.height))):i=ns.fileIcon;var t='<a href="#" id="'+this.id+'" title="'+ns.t("core","changeFile")+'" class="thumbnail"';void 0!==this.field.description&&(t+=' aria-describedby="'+ns.getDescriptionId(this.id)+'"'),t+="><img "+(void 0===i.width?"":' width="'+i.width+'"')+'height="'+i.height+'"  alt="'+(void 0===this.field.label?"":this.field.label)+'"/></a><a href="#" class="remove" title="'+ns.t("core","removeFile")+'"></a>',this.$file.html(t).children(":eq(0)").click((function(){return e.openFileSelector(),!1})).children("img").attr("src",i.path).end().next().click((function(){return e.confirmRemovalDialog.show(H5P.jQuery(this).offset().top),!1})),e.$copyrightButton.removeClass("hidden")},ns.File.prototype.validate=function(){return!0},ns.File.prototype.remove=function(){this.$file.parent().remove()},ns.File.prototype.ready=function(i){this.passReadies?this.parent.ready(i):i()},ns.widgets.file=ns.File;