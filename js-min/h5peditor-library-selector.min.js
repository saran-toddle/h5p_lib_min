ns.LibrarySelector=function(e,r,t){var a=this;this.libraries=e,H5P.EventDispatcher.call(this);try{if(this.defaultParams=JSON.parse(t),!(this.defaultParams instanceof Object))throw!0}catch(e){this.defaultParams={}}this.defaultLibrary=this.currentLibrary=r,this.defaultLibraryParameterized=r?r.replace(".","-").toLowerCase():void 0,this.$tutorialUrl=ns.$('<a class="h5p-tutorial-url" target="_blank"><span class="h5p-tutorial-url-label">'+ns.t("core","tutorial")+"</span></a>").hide(),this.$exampleUrl=ns.$('<a class="h5p-example-url" target="_blank"><span class="h5p-example-url-label">'+ns.t("core","example")+"</span></a>").hide();var o=new H5P.ConfirmationDialog({headerText:H5PEditor.t("core","changeLibrary"),dialogText:H5PEditor.t("core","confirmChangeLibrary")}).appendTo(document.body);this.selector=new ns.SelectorLegacy(e,r,o),this.$selector=ns.$(this.selector.getElement());var i=function(e){a.currentLibrary=e.uberName,a.loadSemantics(e.uberName,a.selector.getParams(),a.selector.getMetadata()),a.$tutorialUrl.attr("href",e.tutorialUrl?e.tutorialUrl:"#").toggle(!!e.tutorialUrl),a.$exampleUrl.attr("href",e.exampleUrl?e.exampleUrl:"#").toggle(!!e.exampleUrl)},s=function(){a.trigger("editorload",a.selector.currentLibrary),a.selector.getSelectedLibrary(i)};this.confirmPasteError=function(e,r,t){var a=new H5P.ConfirmationDialog({headerText:H5PEditor.t("core","pasteError"),dialogText:e,cancelText:" ",confirmText:H5PEditor.t("core","ok")}).appendTo(document.body);a.on("confirmed",t),a.show(r)},o.on("confirmed",s),o.on("canceled",(function(){a.selector.resetSelection(a.currentLibrary,a.defaultParams,a.form.metadata,!0)})),this.selector.on("selected",s),this.selector.on("resize",(function(){a.trigger("resize")})),this.on("select",s),H5P.externalDispatcher.on("datainclipboard",this.updateCopyPasteButtons.bind(this)),this.selector.on("paste",this.pasteContent.bind(this))},ns.LibrarySelector.prototype=Object.create(H5P.EventDispatcher.prototype),ns.LibrarySelector.prototype.constructor=ns.LibrarySelector,ns.LibrarySelector.prototype.setLibrary=function(e){this.trigger("select")},ns.LibrarySelector.prototype.appendTo=function(e){this.$parent=e,this.$selector.appendTo(e)},ns.LibrarySelector.prototype.updateCopyPasteButtons=function(){if(!window.localStorage)return;ns.canPastePlus(H5P.getClipboard(),this.libraries).canPaste},ns.LibrarySelector.prototype.pasteContent=function(){var e=this,r=H5P.getClipboard();ns.confirmReplace(e.getCurrentLibrary(),e.$parent.offset().top,(function(){e.selector.resetSelection(r.generic.library,r.generic.params,r.generic.metadata,!1),e.setLibrary()}))},ns.LibrarySelector.prototype.loadSemantics=function(e,r,t){var a=this;if(void 0!==this.form&&this.form.remove(),"-"!==e){this.$parent.attr("class","h5peditor "+e.split(" ")[0].toLowerCase().replace(".","-")+"-editor");var o=ns.$('<div class="h5peditor-loading h5p-throbber">'+ns.t("core","loading")+"</div>").appendTo(this.$parent);this.$selector.attr("disabled",!0),ns.resetLoadedLibraries(),ns.loadLibrary(e,(function(i){if(i){var s={};r?(s=r,a.defaultParams=s):e!==a.defaultLibrary&&e!==a.defaultLibraryParameterized||(s=a.defaultParams),t||(t=s.metadata);const n=t&&t.defaultLanguage?t.defaultLanguage:null;a.form=new ns.Form(e,ns.libraryCache[e].languages,n),a.form.replace(o),a.form.currentLibrary=e,a.form.processSemantics(i,s,t),a.updateCopyPasteButtons()}else a.form=ns.$("<div/>",{class:"h5p-errors",text:H5PEditor.t("core","noSemantics"),insertAfter:o});a.$selector.attr("disabled",!1),o.remove(),a.trigger("editorloaded",e)}))}else this.$parent.attr("class","h5peditor")},ns.LibrarySelector.prototype.getCurrentLibrary=function(){return this.currentLibrary},ns.LibrarySelector.prototype.getParams=function(){if(void 0!==this.form){var e=!0;if(void 0!==this.form.metadataForm.children)for(var r=0;r<this.form.metadataForm.children.length;r++)!1===this.form.metadataForm.children[r].validate()&&(e=!1);if(void 0!==this.form.children)for(r=0;r<this.form.children.length;r++)!1===this.form.children[r].validate()&&(e=!1);return!!e&&this.form.params}},ns.LibrarySelector.prototype.getMetadata=function(){if(void 0!==this.form)return this.form.metadata},ns.LibrarySelector.prototype.presave=function(e,r){return(new ns.Presave).process(r,e)};