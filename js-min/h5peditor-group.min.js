ns.Group=function(t,e,i,s){if(H5P.EventDispatcher.call(this),void 0===e.label?e.label=e.name:0===e.label&&(e.label=""),this.parent=t,this.passReadies=!0,this.params=i,this.setValue=s,this.library=t.library+"/"+e.name,void 0!==e.deprecated&&e.deprecated){this.field=H5P.cloneObject(e,!0);for(var a=0,n=0;n<this.field.fields.length;n++){var r=this.field.fields[n];void 0!==i&&""===i[r.name]&&delete i[r.name],void 0!==i&&void 0!==i[r.name]||(r.widget="none",a++)}n===a&&(this.field.fields=[])}else this.field=e;if(!0===this.field.optional)for(var o=0;o<this.field.fields.length;o++)this.field.fields[o].optional=!0},ns.Group.prototype=Object.create(H5P.EventDispatcher.prototype),ns.Group.prototype.constructor=ns.Group,ns.Group.prototype.appendTo=function(t){var e=this;if(0!==this.field.fields.length){if(this.$group=ns.$("<fieldset/>",{class:"field group "+H5PEditor.createImportance(this.field.importance)+" field-name-"+this.field.name,appendTo:t}),this.$title=ns.$("<div/>",{class:"title","aria-expanded":"false",title:ns.t("core","expandCollapse"),role:"button",tabIndex:0,on:{click:function(){e.toggle()},keypress:function(t){32===(t.charCode||t.keyCode)&&(e.toggle(),t.preventDefault())}},appendTo:this.$group}),this.$content=ns.$("<div/>",{class:"content",appendTo:this.$group}),this.hasSingleChild()&&!this.isSubContent()){this.$content.addClass("h5peditor-single"),this.children=[];var i=this.field.fields[0],s=void 0===i.widget?i.type:i.widget;this.children[0]=new ns.widgets[s](this,i,this.params,(function(t,i){e.setValue(e.field,i)})),this.children[0].appendTo(this.$content)}else void 0===this.params&&(this.params={},this.setValue(this.field,this.params)),this.params=this.initSubContent(this.params),ns.processSemanticsChunk(this.field.fields,this.params,this.$content,this);this.findSummary(),!0===this.field.expanded&&this.expand()}else this.setValue(this.field)},ns.Group.prototype.hasSingleChild=function(){return 1===this.field.fields.length},ns.Group.prototype.initSubContent=function(t){return this.isSubContent()&&(t.subContentId=t.subContentId||H5P.createUUID()),t},ns.Group.prototype.isSubContent=function(){return!0===this.field.isSubContent},ns.Group.prototype.toggle=function(){this.preventToggle?this.preventToggle=!1:this.$group.hasClass("expanded")?this.collapse():this.expand()},ns.Group.prototype.expand=function(){this.$title.attr("aria-expanded","true"),setTimeout(function(){this.trigger("expanded"),this.$group.addClass("expanded")}.bind(this),100)},ns.Group.prototype.collapse=function(){for(var t=!0,e=0;e<this.children.length;e++)!1===this.children[e].validate()&&(t=!1);t&&(this.$title.attr("aria-expanded","false"),setTimeout(function(){this.trigger("collapsed"),this.$group.removeClass("expanded")}.bind(this),100))},ns.Group.prototype.findSummary=function(){for(var t,e=this,i=0;i<this.children.length;i++){var s=this.children[i];if(void 0!==s.field){var a=e.hasSingleChild()&&!e.isSubContent()?this.params:this.params[s.field.name],n=ns.getWidgetName(s.field);if("text"===n||"html"===n){void 0!==a&&""!==a&&(t=a.replace(/(<([^>]+)>)/gi,"")),s.$input.change((function(){var t=e.hasSingleChild()&&!e.isSubContent()?e.params:e.params[s.field.name];void 0!==t&&""!==t&&e.setSummary(t.replace(/(<([^>]+)>)/gi,""))}));break}if("library"===n){let i;void 0!==s.params&&(t=s.$select.children(":selected").text(),s.params.metadata&&s.params.metadata.title?t=s.params.metadata.title+(!s.libraries||s.libraries.length>1&&-1===s.params.metadata.title.indexOf(t)?" ("+t+")":""):s.params.library||(t=e.field.label));const a=function(){s.params&&s.params.metadata&&s.params.metadata.title?e.setSummary(s.params.metadata.title+(s.libraries.length>1&&-1===s.params.metadata.title.indexOf(i.title)?" ("+i.title+")":"")):e.setSummary(i?i.title:e.field.label)};s.metadataForm&&s.metadataForm.on("titlechange",a),s.change((function(t){i=t,a(),s.metadataForm&&(s.metadataForm.off("titlechange",a),s.metadataForm.on("titlechange",a))}));break}}}this.setSummary(t)},ns.Group.prototype.setSummary=function(t){var e,i=ns.$.parseHTML(t);null!==i&&i.length&&(e=i[0].nodeValue),this.trigger("summary",e),e=void 0!==e?e.length>48?e.substr(0,45)+"...":e:this.field.label,this.$title.text(e)},ns.Group.prototype.validate=function(){var t=!0;if(void 0!==this.children)for(var e=0;e<this.children.length;e++)!1===this.children[e].validate()&&(t=!1);return t},ns.Group.prototype.forEachChild=function(t){for(var e=0;e<this.children.length;e++)t(this.children[e],e)},ns.Group.prototype.ready=function(t){this.parent.ready(t)},ns.Group.prototype.remove=function(){void 0!==this.$group&&(ns.removeChildren(this.children),this.$group.remove())},ns.Group.prototype.getFields=function(){return H5PEditor.$.extend(!0,[],this.field.fields)},ns.Group.prototype.forceValue=function(t){for(let e=0;e<this.children.length;e++)this.children[e].forceValue(t[this.children[e].field.name])},ns.widgets.group=ns.Group;